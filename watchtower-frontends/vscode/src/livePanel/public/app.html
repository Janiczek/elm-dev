<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!--
    Use a content security policy to only allow loading images from https or from our extension directory,
    and only allow scripts that have a specific nonce.
    -->
    <!-- <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'none'; img-src vscode-resource: https:; connect-src 'self'; script-src 'nonce-1234nonce'; style-src 'unsafe-inline';"
    /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <script nonce="1234nonce" src="http://localhost:9000/app/live.js"></script> -->
    <script src="http://localhost:9000/app/live.js"></script>
    <title>Live View</title>
  </head>
  <body>
    <!-- <script nonce="1234nonce"> -->
    <script>
      var app = Elm.Main.init();

      // Create WebSocket connection.
      console.log("Connecting to websocket");
      const socket = new WebSocket("ws://localhost:9000/ws");

      // Connection opened
      socket.addEventListener("open", function (event) {
        console.log("Connected!");
      });

      // Listen for messages from the watchtower
      socket.addEventListener("message", function (event) {
        console.log("received", JSON.parse(event.data));
        app.ports.editorChange.send(JSON.parse(event.data));
      });

      app.ports.notify.subscribe(function (json) {
        socket.send(JSON.stringify(json));
      });
    </script>
  </body>
</html>
